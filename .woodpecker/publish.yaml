when:
  - event: tag
  - event: manual
steps:
  publish_tag:
    when:
      - event: tag
    image: woodpeckerci/plugin-docker-buildx
    settings:
      dockerfile: Dockerfile
      platforms: linux/amd64, linux/arm64/v8
      repo: mrmn/pdfding
      registry: docker.io
      tags: latest, ${CI_COMMIT_TAG}
      username: ${CI_REPO_OWNER}
      password:
        from_secret: DOCKER_TOKEN
  publish_manual:
    when:
      - event: manual
        evaluate: 'TAG != ""'
    image: woodpeckerci/plugin-docker-buildx
    settings:
      dockerfile: Dockerfile
      platforms: linux/amd64
      repo: mrmn/pdfding
      registry: docker.io
      tags: ${TAG}
      username: ${CI_REPO_OWNER}
      password:
        from_secret: DOCKER_TOKEN

